import{f as S,a as x,c as ka}from"../chunks/Cev2le5R.js";import"../chunks/CRuFngHP.js";import{o as Ta,a as xa}from"../chunks/BsW9PFV7.js";import{t as Sa,n as D,v as Aa,g as i,av as Na,w as Ia,H as Ca,x as je,y as Me,z as Pe,o as Ie,W as Ma,ao as Pa,a6 as Ke,i as Ee,l as Ue,aK as te,m as Fe,s as Ua,R as Ye,aG as O,am as Be,aL as Da,aM as La,aN as Oa,aO as Ha,j as aa,p as ta,aP as De,ai as Ra,al as $a,k as Fa,K as Ja,aQ as ra,V as sa,aR as Ba,aS as Ga,aT as za,aU as qa,aV as Va,aW as ja,aX as ia,aI as Ka,b as la,S as na,aY as Ya,C as Wa,B as Le,D as G,F as Qa,G as u,J as _,I as d,ax as w,a7 as Xa,aZ as Za}from"../chunks/Di3f2kmZ.js";import{e as W,s as N}from"../chunks/D0cUWV5K.js";import{i as Q}from"../chunks/CT7lAwHm.js";import{i as et}from"../chunks/C-aEf4AJ.js";function Oe(e,a){return a}function at(e,a,s){for(var t=[],l=a.length,r,v=a.length,m=0;m<l;m++){let I=a[m];ta(I,()=>{if(r){if(r.pending.delete(I),r.done.add(I),r.pending.size===0){var b=e.outrogroups;Je(Be(r.done)),b.delete(r),b.size===0&&(e.outrogroups=null)}}else v-=1},!1)}if(v===0){var f=t.length===0&&s!==null;if(f){var g=s,p=g.parentNode;$a(p),p.append(g),e.items.clear()}Je(a,!f)}else r={pending:new Set(a),done:new Set},(e.outrogroups??(e.outrogroups=new Set)).add(r)}function Je(e,a=!0){for(var s=0;s<e.length;s++)Fa(e[s],a)}var We;function He(e,a,s,t,l,r=null){var v=e,m=new Map,f=(a&ra)!==0;if(f){var g=e;v=D?Me(Ja(g)):g.appendChild(Ue())}D&&Aa();var p=null,I=Na(()=>{var h=s();return Da(h)?h:h==null?[]:Be(h)}),b,k=!0;function H(){n.fallback=p,tt(n,b,v,a,t),p!==null&&(b.length===0?p.f&te?(p.f^=te,Te(p,null,v)):aa(p):ta(p,()=>{p=null}))}var R=Sa(()=>{b=i(I);var h=b.length;let X=!1;if(D){var re=Ia(v)===Ca;re!==(h===0)&&(v=je(),Me(v),Pe(!1),X=!0)}for(var L=new Set,Z=Ee,se=Ua(),M=0;M<h;M+=1){D&&Ie.nodeType===Ma&&Ie.data===Pa&&(v=Ie,X=!0,Pe(!1));var ee=b[M],ie=t(ee,M),P=k?null:m.get(ie);P?(P.v&&Ke(P.v,ee),P.i&&Ke(P.i,M),se&&Z.skipped_effects.delete(P.e)):(P=rt(m,k?v:We??(We=Ue()),ee,ie,M,l,a,s),k||(P.e.f|=te),m.set(ie,P)),L.add(ie)}if(h===0&&r&&!p&&(k?p=Fe(()=>r(v)):(p=Fe(()=>r(We??(We=Ue()))),p.f|=te)),D&&h>0&&Me(je()),!k)if(se){for(const[ue,le]of m)L.has(ue)||Z.skipped_effects.add(le.e);Z.oncommit(H),Z.ondiscard(()=>{})}else H();X&&Pe(!0),i(I)}),n={effect:R,items:m,outrogroups:null,fallback:p};k=!1,D&&(v=Ie)}function tt(e,a,s,t,l){var P,ue,le,ge,be,xe,fe,ce,Se;var r=(t&Ba)!==0,v=a.length,m=e.items,f=e.effect.first,g,p=null,I,b=[],k=[],H,R,n,h;if(r)for(h=0;h<v;h+=1)H=a[h],R=l(H,h),n=m.get(R).e,n.f&te||((ue=(P=n.nodes)==null?void 0:P.a)==null||ue.measure(),(I??(I=new Set)).add(n));for(h=0;h<v;h+=1){if(H=a[h],R=l(H,h),n=m.get(R).e,e.outrogroups!==null)for(const B of e.outrogroups)B.pending.delete(n),B.done.delete(n);if(n.f&te)if(n.f^=te,n===f)Te(n,null,s);else{var X=p?p.next:f;n===e.effect.last&&(e.effect.last=n.prev),n.prev&&(n.prev.next=n.next),n.next&&(n.next.prev=n.prev),de(e,p,n),de(e,n,X),Te(n,X,s),p=n,b=[],k=[],f=p.next;continue}if(n.f&De&&(aa(n),r&&((ge=(le=n.nodes)==null?void 0:le.a)==null||ge.unfix(),(I??(I=new Set)).delete(n))),n!==f){if(g!==void 0&&g.has(n)){if(b.length<k.length){var re=k[0],L;p=re.prev;var Z=b[0],se=b[b.length-1];for(L=0;L<b.length;L+=1)Te(b[L],re,s);for(L=0;L<k.length;L+=1)g.delete(k[L]);de(e,Z.prev,se.next),de(e,p,Z),de(e,se,re),f=re,p=se,h-=1,b=[],k=[]}else g.delete(n),Te(n,f,s),de(e,n.prev,n.next),de(e,n,p===null?e.effect.first:p.next),de(e,p,n),p=n;continue}for(b=[],k=[];f!==null&&f!==n;)(g??(g=new Set)).add(f),k.push(f),f=f.next;if(f===null)continue}n.f&te||b.push(n),p=n,f=n.next}if(e.outrogroups!==null){for(const B of e.outrogroups)B.pending.size===0&&(Je(Be(B.done)),(be=e.outrogroups)==null||be.delete(B));e.outrogroups.size===0&&(e.outrogroups=null)}if(f!==null||g!==void 0){var M=[];if(g!==void 0)for(n of g)n.f&De||M.push(n);for(;f!==null;)!(f.f&De)&&f!==e.fallback&&M.push(f),f=f.next;var ee=M.length;if(ee>0){var ie=t&ra&&v===0?s:null;if(r){for(h=0;h<ee;h+=1)(fe=(xe=M[h].nodes)==null?void 0:xe.a)==null||fe.measure();for(h=0;h<ee;h+=1)(Se=(ce=M[h].nodes)==null?void 0:ce.a)==null||Se.fix()}at(e,M,ie)}}r&&sa(()=>{var B,Ae;if(I!==void 0)for(n of I)(Ae=(B=n.nodes)==null?void 0:B.a)==null||Ae.apply()})}function rt(e,a,s,t,l,r,v,m){var f=v&La?v&Oa?Ye(s):O(s,!1,!1):null,g=v&Ha?Ye(l):null;return{v:f,i:g,e:Fe(()=>(r(a,f??s,g??l,m),()=>{e.delete(t)}))}}function Te(e,a,s){if(e.nodes)for(var t=e.nodes.start,l=e.nodes.end,r=a&&!(a.f&te)?a.nodes.start:s;t!==null;){var v=Ra(t);if(r.before(t),t===l)return;t=v}}function de(e,a,s){a===null?e.effect.first=s:a.next=s,s===null?e.effect.last=a:s.prev=a}const Qe=[...` 	
\r\f \v\uFEFF`];function st(e,a,s){var t=""+e;if(s){for(var l in s)if(s[l])t=t?t+" "+l:l;else if(t.length)for(var r=l.length,v=0;(v=t.indexOf(l,v))>=0;){var m=v+r;(v===0||Qe.includes(t[v-1]))&&(m===t.length||Qe.includes(t[m]))?t=(v===0?"":t.substring(0,v))+t.substring(m+1):v=m}}return t===""?null:t}function it(e,a){return e==null?null:String(e)}function lt(e,a,s,t,l,r){var v=e.__className;if(D||v!==s||v===void 0){var m=st(s,t,r);(!D||m!==e.getAttribute("class"))&&(m==null?e.removeAttribute("class"):e.className=m),e.__className=s}else if(r&&l!==r)for(var f in r){var g=!!r[f];(l==null||g!==!!l[f])&&e.classList.toggle(f,g)}return r}function nt(e,a,s,t){var l=e.__style;if(D||l!==a){var r=it(a);(!D||r!==e.getAttribute("style"))&&(r==null?e.removeAttribute("style"):e.style.cssText=r),e.__style=a}return t}const ot=Symbol("is custom element"),vt=Symbol("is html");function Xe(e){if(D){var a=!1,s=()=>{if(!a){if(a=!0,e.hasAttribute("value")){var t=e.value;Ce(e,"value",null),e.value=t}if(e.hasAttribute("checked")){var l=e.checked;Ce(e,"checked",null),e.checked=l}}};e.__on_r=s,sa(s),ja()}}function Ce(e,a,s,t){var l=dt(e);D&&(l[a]=e.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&e.nodeName==="LINK")||l[a]!==(l[a]=s)&&(a==="loading"&&(e[Ga]=s),s==null?e.removeAttribute(a):typeof s!="string"&&ut(e).includes(a)?e[a]=s:e.setAttribute(a,s))}function dt(e){return e.__attributes??(e.__attributes={[ot]:e.nodeName.includes("-"),[vt]:e.namespaceURI===za})}var Ze=new Map;function ut(e){var a=e.getAttribute("is")||e.nodeName,s=Ze.get(a);if(s)return s;Ze.set(a,s=[]);for(var t,l=e,r=Element.prototype;r!==l;){t=Va(l);for(var v in t)t[v].set&&s.push(v);l=qa(l)}return s}function ea(e,a,s=a){var t=new WeakSet;ia(e,"input",async l=>{var r=l?e.defaultValue:e.value;if(r=Re(e)?$e(r):r,s(r),Ee!==null&&t.add(Ee),await Ka(),r!==(r=a())){var v=e.selectionStart,m=e.selectionEnd,f=e.value.length;if(e.value=r??"",m!==null){var g=e.value.length;v===m&&m===f&&g>f?(e.selectionStart=g,e.selectionEnd=g):(e.selectionStart=v,e.selectionEnd=Math.min(m,g))}}}),(D&&e.defaultValue!==e.value||la(a)==null&&e.value)&&(s(Re(e)?$e(e.value):e.value),Ee!==null&&t.add(Ee)),na(()=>{var l=a();if(e===document.activeElement){var r=Ya??Ee;if(t.has(r))return}Re(e)&&l===$e(e.value)||e.type==="date"&&!l&&!e.value||l!==e.value&&(e.value=l??"")})}function ft(e,a,s=a){ia(e,"change",t=>{var l=t?e.defaultChecked:e.checked;s(l)}),(D&&e.defaultChecked!==e.checked||la(a)==null)&&s(e.checked),na(()=>{var t=a();e.checked=!!t})}function Re(e){var a=e.type;return a==="number"||a==="range"}function $e(e){return e===""?null:+e}function ct(e){return function(...a){var s=a[0];s.target===this&&(e==null||e.apply(this,a))}}const pt="/api";async function ae(e,a,s,t={}){const l=await fetch(`${pt}${a}`,{method:e,headers:t,body:s});if(!l.ok){let r=`HTTP ${l.status}`;try{r=(await l.json()).detail||r}catch{}throw new Error(r)}return l.status===204?null:l.json()}const z={listUploads(){return ae("GET","/uploads")},getUpload(e){return ae("GET",`/uploads/${e}`)},getSegments(e){return ae("GET",`/uploads/${e}/segments`)},renameUpload(e,a){return ae("PATCH",`/uploads/${e}`,JSON.stringify({display_name:a}),{"Content-Type":"application/json"})},deleteUpload(e){return ae("DELETE",`/uploads/${e}`)},createUpload(e){return ae("POST","/uploads",e)},getJob(e){return ae("GET",`/jobs/${e}`)},listPrompts(){return ae("GET","/prompts")},updatePrompt(e,a){return ae("PUT",`/prompts/${e}`,JSON.stringify(a),{"Content-Type":"application/json"})}};var _t=S('<div class="error svelte-1uha8ag"> </div>'),mt=S('<div><button class="itemMain svelte-1uha8ag"><div class="itemName svelte-1uha8ag"> </div> <div class="itemMeta muted svelte-1uha8ag"> </div></button> <button class="btn danger">Del</button></div>'),ht=S('<div class="error svelte-1uha8ag"> </div>'),gt=S('<div class="jobBar svelte-1uha8ag"><div><strong>Job:</strong> </div> <div class="muted"> </div> <div class="progress svelte-1uha8ag"><div class="progressFill svelte-1uha8ag"></div></div> <!></div>'),bt=S('<div class="seg svelte-1uha8ag"><div class="segMeta muted svelte-1uha8ag"> </div> <div> </div></div>'),yt=S('<div class="segments svelte-1uha8ag"></div>'),wt=S('<pre class="pre svelte-1uha8ag"> </pre>'),Et=S('<div class="muted">No transcript yet.</div>'),kt=S('<pre class="pre svelte-1uha8ag"> </pre>'),Tt=S('<div class="muted">No summary.</div>'),xt=S('<pre class="pre svelte-1uha8ag"> </pre>'),St=S('<div class="muted">No action items.</div>'),At=S('<div class="header svelte-1uha8ag"><div><div class="h1 svelte-1uha8ag"> </div> <div class="muted"> </div></div> <div class="headerActions svelte-1uha8ag"><button class="btn">Rename</button> <a class="btn" target="_blank" rel="noreferrer">Audio</a></div></div> <div class="panel svelte-1uha8ag"><audio controls style="width: 100%"></audio></div> <div class="grid svelte-1uha8ag"><section class="panel svelte-1uha8ag"><div class="panelTitle svelte-1uha8ag">Transcript</div> <!></section> <section class="panel svelte-1uha8ag"><div class="panelTitle svelte-1uha8ag">Summary</div> <!> <div style="height: 12px"></div> <div class="panelTitle svelte-1uha8ag">Action items</div> <!></section></div>',1),Nt=S('<div class="empty svelte-1uha8ag"><div class="h1 svelte-1uha8ag">Upload audio to begin</div> <div class="muted">Files are queued in RabbitMQ and processed by the worker.</div></div>'),It=S('<button class="promptItem svelte-1uha8ag"><div><strong> </strong> </div> <div class="muted"> </div></button>'),Ct=S('<div class="promptEditor svelte-1uha8ag"><label class="label svelte-1uha8ag" for="promptNameInput">Name</label> <input id="promptNameInput" class="input"/> <label class="check svelte-1uha8ag" style="margin-top: 8px"><input type="checkbox"/> Default for this kind</label> <label class="label svelte-1uha8ag" for="promptContentInput" style="margin-top: 8px">Content</label> <textarea id="promptContentInput" class="textarea" rows="14"></textarea> <div style="display:flex; gap:8px; margin-top:8px"><button class="btn primary">Save</button></div></div>'),Mt=S('<div class="muted">Select a prompt to edit.</div>'),Pt=S('<div class="modalBackdrop svelte-1uha8ag" role="button" tabindex="0"><div class="modal svelte-1uha8ag" role="dialog" aria-modal="true" aria-label="Prompts editor"><div class="modalHeader svelte-1uha8ag"><div class="h2 svelte-1uha8ag">Prompts</div> <button class="btn">Close</button></div> <div class="modalBody svelte-1uha8ag"><div class="promptList svelte-1uha8ag"></div> <!></div></div></div>'),Ut=S('<div class="layout svelte-1uha8ag"><aside class="sidebar svelte-1uha8ag"><div class="sidebarHeader svelte-1uha8ag"><div class="title svelte-1uha8ag">Listen</div> <button class="btn">Prompts</button></div> <form class="uploadForm svelte-1uha8ag"><label class="label svelte-1uha8ag" for="fileInput">Upload audio</label> <input id="fileInput" class="input" name="file" type="file" accept="audio/*" required/> <div class="row svelte-1uha8ag"><label class="check svelte-1uha8ag"><input type="checkbox" name="summarize" value="true"/> Summarize</label> <label class="check svelte-1uha8ag"><input type="checkbox" name="action_items" value="true"/> Action items</label></div> <input class="input" name="display_name" placeholder="Name (optional)"/> <input class="input" name="llm_model" placeholder="LLM model (optional)"/> <button class="btn primary"> </button> <!></form> <div class="list svelte-1uha8ag"><div class="listHeader svelte-1uha8ag">Library</div> <!></div></aside> <main class="main svelte-1uha8ag"><!> <!></main></div> <!>',1);function Jt(e,a){Wa(a,!1);let s=O([]),t=O(null),l=O([]),r=O(null),v=null,m=O([]),f=O(!1),g=O(null),p=O(""),I=O(""),b=O(!1),k=O(!1),H=O("");async function R(){w(s,await z.listUploads())}async function n(o){w(t,await z.getUpload(o)),w(l,await z.getSegments(o))}function h(o){return new Date(o).toLocaleString()}function X(o){const c=Math.floor(o/60),y=Math.floor(o%60);return`${c}:${y.toString().padStart(2,"0")}`}async function re(o,c){v&&clearInterval(v),w(r,await z.getJob(o)),v=setInterval(async()=>{try{w(r,await z.getJob(o)),await R(),c&&await n(c),(i(r).status==="completed"||i(r).status==="failed")&&(clearInterval(v),v=null)}catch{}},1e3)}async function L(o){o.preventDefault(),w(H,""),w(k,!0);try{const c=new FormData(o.target),y=await z.createUpload(c);await R(),await n(y.upload_id),await re(y.job_id,y.upload_id),o.target.reset()}catch(c){w(H,c.message||"Upload failed")}finally{w(k,!1)}}async function Z(){if(!i(t))return;const o=prompt("Rename file",i(t).display_name);o&&(await z.renameUpload(i(t).id,o.trim()),await R(),await n(i(t).id))}async function se(o){var c;confirm(`Delete "${o.display_name}"?`)&&(await z.deleteUpload(o.id),((c=i(t))==null?void 0:c.id)===o.id&&(w(t,null),w(l,[])),await R())}function M(o){(o.key==="Escape"||o.key==="Enter"||o.key===" ")&&w(f,!1)}async function ee(){w(m,await z.listPrompts()),w(f,!0)}function ie(o){w(g,o.id),w(p,o.name),w(I,o.content),w(b,o.is_default)}async function P(){i(g)&&(await z.updatePrompt(i(g),{name:i(p),content:i(I),is_default:i(b)}),w(m,await z.listPrompts()))}Ta(async()=>{await R()}),xa(()=>{v&&clearInterval(v)}),et();var ue=Ut(),le=Le(ue),ge=u(le),be=u(ge),xe=_(u(be),2);d(be);var fe=_(be,2),ce=_(u(fe),10),Se=u(ce,!0);d(ce);var B=_(ce,2);{var Ae=o=>{var c=_t(),y=u(c,!0);d(c),G(()=>N(y,i(H))),x(o,c)};Q(B,o=>{i(H)&&o(Ae)})}d(fe);var Ge=_(fe,2),oa=_(u(Ge),2);He(oa,1,()=>i(s),Oe,(o,c)=>{var y=mt();let $;var U=u(y),q=u(U),F=u(q,!0);d(q);var ne=_(q,2),oe=u(ne,!0);d(ne),d(U);var ve=_(U,2);d(y),G(C=>{var E;$=lt(y,1,"item svelte-1uha8ag",null,$,{active:((E=i(t))==null?void 0:E.id)===i(c).id}),N(F,i(c).display_name),N(oe,C)},[()=>h(i(c).created_at)]),W("click",U,()=>n(i(c).id)),W("click",ve,()=>se(i(c))),x(o,y)}),d(Ge),d(ge);var ze=_(ge,2),qe=u(ze);{var va=o=>{var c=gt(),y=u(c),$=_(u(y));d(y);var U=_(y,2),q=u(U);d(U);var F=_(U,2),ne=u(F);d(F);var oe=_(F,2);{var ve=C=>{var E=ht(),J=u(E,!0);d(E),G(()=>N(J,i(r).error)),x(C,E)};Q(oe,C=>{i(r).error&&C(ve)})}d(c),G(()=>{N($,` ${i(r).status??""} ${i(r).phase?`(${i(r).phase})`:""}`),N(q,`${i(r).current_chunk??0??""}/${i(r).total_chunks??0??""} · ${i(r).progress??""}%`),nt(ne,`width:${i(r).progress}%`)}),x(o,c)};Q(qe,o=>{i(r)&&o(va)})}var da=_(qe,2);{var ua=o=>{var c=At(),y=Le(c),$=u(y),U=u($),q=u(U,!0);d(U);var F=_(U,2),ne=u(F,!0);d(F),d($);var oe=_($,2),ve=u(oe),C=_(ve,2);d(oe),d(y);var E=_(y,2),J=u(E);d(E);var V=_(E,2),j=u(V),pe=_(u(j),2);{var ye=T=>{var A=yt();He(A,5,()=>i(l),Oe,(_e,me)=>{var ke=bt(),Y=u(ke),he=u(Y);d(Y);var Ne=_(Y,2),ya=u(Ne,!0);d(Ne),d(ke),G((wa,Ea)=>{N(he,`${wa??""}–${Ea??""}`),N(ya,i(me).text)},[()=>X(i(me).start_time),()=>X(i(me).end_time)]),x(_e,ke)}),d(A),x(T,A)},we=T=>{var A=ka(),_e=Le(A);{var me=Y=>{var he=wt(),Ne=u(he,!0);d(he),G(()=>N(Ne,i(t).transcript_text)),x(Y,he)},ke=Y=>{var he=Et();x(Y,he)};Q(_e,Y=>{i(t).transcript_text?Y(me):Y(ke,!1)},!0)}x(T,A)};Q(pe,T=>{i(l).length?T(ye):T(we,!1)})}d(j);var K=_(j,2),Ve=_(u(K),2);{var _a=T=>{var A=kt(),_e=u(A,!0);d(A),G(()=>N(_e,i(t).summary)),x(T,A)},ma=T=>{var A=Tt();x(T,A)};Q(Ve,T=>{i(t).summary?T(_a):T(ma,!1)})}var ha=_(Ve,6);{var ga=T=>{var A=xt(),_e=u(A,!0);d(A),G(me=>N(_e,me),[()=>JSON.stringify(i(t).action_items,null,2)]),x(T,A)},ba=T=>{var A=St();x(T,A)};Q(ha,T=>{i(t).action_items?T(ga):T(ba,!1)})}d(K),d(V),G(()=>{N(q,i(t).display_name),N(ne,i(t).original_filename),Ce(C,"href",`/api/uploads/${i(t).id}/audio`),Ce(J,"src",`/api/uploads/${i(t).id}/audio`)}),W("click",ve,Z),x(o,c)},fa=o=>{var c=Nt();x(o,c)};Q(da,o=>{i(t)?o(ua):o(fa,!1)})}d(ze),d(le);var ca=_(le,2);{var pa=o=>{var c=Pt(),y=u(c),$=u(y),U=_(u($),2);d($);var q=_($,2),F=u(q);He(F,5,()=>i(m),Oe,(C,E)=>{var J=It(),V=u(J),j=u(V),pe=u(j,!0);d(j);var ye=_(j);d(V);var we=_(V,2),K=u(we,!0);d(we),d(J),G(()=>{N(pe,i(E).kind),N(ye,` ${i(E).is_default?"(default)":""}`),N(K,i(E).name)}),W("click",J,()=>ie(i(E))),x(C,J)}),d(F);var ne=_(F,2);{var oe=C=>{var E=Ct(),J=_(u(E),2);Xe(J);var V=_(J,2),j=u(V);Xe(j),Xa(),d(V);var pe=_(V,4);Za(pe);var ye=_(pe,2),we=u(ye);d(ye),d(E),ea(J,()=>i(p),K=>w(p,K)),ft(j,()=>i(b),K=>w(b,K)),ea(pe,()=>i(I),K=>w(I,K)),W("click",we,P),x(C,E)},ve=C=>{var E=Mt();x(C,E)};Q(ne,C=>{i(g)?C(oe):C(ve,!1)})}d(q),d(y),d(c),W("click",U,()=>w(f,!1)),W("keydown",c,M),W("click",c,ct(()=>w(f,!1))),x(o,c)};Q(ca,o=>{i(f)&&o(pa)})}G(()=>{ce.disabled=i(k),N(Se,i(k)?"Uploading…":"Upload & queue")}),W("click",xe,ee),W("submit",fe,L),x(e,ue),Qa()}export{Jt as component};
